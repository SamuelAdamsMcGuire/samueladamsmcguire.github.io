<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@2.27.0/plotly.min.js"></script>
<style>
  body { margin: 0; padding: 8px 12px; background: #16213e; font-family: sans-serif; color: #e0e0e0; box-sizing: border-box; }
  .controls { display: flex; gap: 20px; align-items: center; margin-bottom: 6px; flex-wrap: wrap; }
  .controls > span { font-size: 13px; color: #aaa; }
  .ms-wrap { position: relative; display: inline-flex; align-items: center; gap: 6px; }
  .ms-trigger {
    background: #1e2d4a; color: #e0e0e0; border: 1px solid #3a4a6a;
    border-radius: 4px; padding: 4px 10px; font-size: 13px; cursor: pointer; min-width: 130px; text-align: left;
  }
  .ms-trigger:hover { border-color: #00d4aa; }
  .ms-panel {
    display: none; position: absolute; top: calc(100% + 4px); left: 0; z-index: 200;
    background: #1e2d4a; border: 1px solid #3a4a6a; border-radius: 4px;
    padding: 4px 0; min-width: 150px; max-height: 220px; overflow-y: auto;
    box-shadow: 0 4px 14px rgba(0,0,0,0.5);
  }
  .ms-panel.open { display: block; }
  .ms-panel label {
    display: flex; align-items: center; gap: 8px;
    padding: 4px 12px; cursor: pointer; font-size: 13px; white-space: nowrap;
  }
  .ms-panel label:hover { background: rgba(255,255,255,0.06); }
  .ms-panel input[type=checkbox] { accent-color: #00d4aa; cursor: pointer; flex-shrink: 0; }
  .ms-sep { border-top: 1px solid #3a4a6a; margin: 3px 0; }
  .excl-cb { accent-color: #00d4aa; cursor: pointer; width: 13px; height: 13px; }
  .excl-label { font-size: 12px; color: #888; cursor: pointer; user-select: none; }
  .mode-toggle { display: flex; border: 1px solid #3a4a6a; border-radius: 4px; overflow: hidden; }
  .mode-btn {
    background: #1e2d4a; color: #888; border: none; padding: 4px 12px;
    font-size: 12px; cursor: pointer; transition: background 0.15s, color 0.15s;
  }
  .mode-btn.active { background: #00d4aa; color: #0a0a1a; font-weight: bold; }
  #chart { width: 100%; }
</style>
</head>
<body>
<div class="controls">
  <span>Airline</span>
  <div class="ms-wrap">
    <button class="ms-trigger" id="airlineTrigger">All airlines ▾</button>
    <div class="ms-panel" id="airlinePanel"></div>
    <input type="checkbox" class="excl-cb" id="airlineExclude">
    <label class="excl-label" for="airlineExclude">Exclude</label>
  </div>
  <span>Airport</span>
  <div class="ms-wrap">
    <button class="ms-trigger" id="airportTrigger">All airports ▾</button>
    <div class="ms-panel" id="airportPanel"></div>
    <input type="checkbox" class="excl-cb" id="airportExclude">
    <label class="excl-label" for="airportExclude">Exclude</label>
  </div>
  <div class="mode-toggle" style="margin-left:auto;">
    <button class="mode-btn active" id="btnPct">Error %</button>
    <button class="mode-btn" id="btnAbs">Misorder (t)</button>
    <button class="mode-btn" id="btnUplift">Uplift (t)</button>
  </div>
</div>
<div id="chart"></div>
<script>
const allRows = [{"airline": "3S", "airport": "ORD", "month_order": 7, "month_name": "Jul", "actual_kg": 1278541.0, "flt_pred_kg": 1316360.0, "fp_pred_kg": 1366975.0}, {"airline": "3S", "airport": "FRA", "month_order": 7, "month_name": "Jul", "actual_kg": 10443056.0, "flt_pred_kg": 10357624.0, "fp_pred_kg": 10155247.0}, {"airline": "3S", "airport": "HKG", "month_order": 7, "month_name": "Jul", "actual_kg": 14900546.0, "flt_pred_kg": 14066012.0, "fp_pred_kg": 15391904.0}, {"airline": "4Y", "airport": "PMI", "month_order": 7, "month_name": "Jul", "actual_kg": 673379.0, "flt_pred_kg": 637752.0, "fp_pred_kg": 624519.0}, {"airline": "4Y", "airport": "FRA", "month_order": 7, "month_name": "Jul", "actual_kg": 19624709.0, "flt_pred_kg": 19704173.0, "fp_pred_kg": 18934657.0}, {"airline": "4Y", "airport": "KEF", "month_order": 7, "month_name": "Jul", "actual_kg": 85151.0, "flt_pred_kg": 64041.0, "fp_pred_kg": 114764.0}, {"airline": "4Y", "airport": "HRG", "month_order": 7, "month_name": "Jul", "actual_kg": 183065.0, "flt_pred_kg": 186171.0, "fp_pred_kg": 190192.0}, {"airline": "4Y", "airport": "HAM", "month_order": 7, "month_name": "Jul", "actual_kg": 5226.0, "flt_pred_kg": 3170.0, "fp_pred_kg": 0.0}, {"airline": "EN", "airport": "BLL", "month_order": 7, "month_name": "Jul", "actual_kg": 75195.0, "flt_pred_kg": 88726.0, "fp_pred_kg": 75547.0}, {"airline": "EN", "airport": "FRA", "month_order": 7, "month_name": "Jul", "actual_kg": 3128508.0, "flt_pred_kg": 3289740.0, "fp_pred_kg": 3184616.0}, {"airline": "EW", "airport": "PMI", "month_order": 7, "month_name": "Jul", "actual_kg": 10053338.0, "flt_pred_kg": 9307200.0, "fp_pred_kg": 9343066.0}, {"airline": "EW", "airport": "KEF", "month_order": 7, "month_name": "Jul", "actual_kg": 34763.0, "flt_pred_kg": 31956.0, "fp_pred_kg": 33496.0}, {"airline": "EW", "airport": "HRG", "month_order": 7, "month_name": "Jul", "actual_kg": 315616.0, "flt_pred_kg": 335435.0, "fp_pred_kg": 337291.0}, {"airline": "EW", "airport": "WAW", "month_order": 7, "month_name": "Jul", "actual_kg": 45627.0, "flt_pred_kg": 51533.0, "fp_pred_kg": 41458.0}, {"airline": "EW", "airport": "HAM", "month_order": 7, "month_name": "Jul", "actual_kg": 7302167.0, "flt_pred_kg": 7341371.0, "fp_pred_kg": 7121999.0}, {"airline": "EW", "airport": "VIE", "month_order": 7, "month_name": "Jul", "actual_kg": 827665.0, "flt_pred_kg": 904374.0, "fp_pred_kg": 894557.0}, {"airline": "EW", "airport": "FRA", "month_order": 7, "month_name": "Jul", "actual_kg": 65630.0, "flt_pred_kg": 63142.0, "fp_pred_kg": 62090.0}, {"airline": "LH", "airport": "PMI", "month_order": 7, "month_name": "Jul", "actual_kg": 470589.0, "flt_pred_kg": 445853.0, "fp_pred_kg": 408893.0}, {"airline": "LH", "airport": "BLL", "month_order": 7, "month_name": "Jul", "actual_kg": 384048.0, "flt_pred_kg": 360774.0, "fp_pred_kg": 489242.0}, {"airline": "LH", "airport": "VIE", "month_order": 7, "month_name": "Jul", "actual_kg": 62278.0, "flt_pred_kg": 79434.0, "fp_pred_kg": 95344.0}, {"airline": "LH", "airport": "ORD", "month_order": 7, "month_name": "Jul", "actual_kg": 6264269.0, "flt_pred_kg": 6563228.0, "fp_pred_kg": 6214525.0}, {"airline": "LH", "airport": "KEF", "month_order": 7, "month_name": "Jul", "actual_kg": 177265.0, "flt_pred_kg": 243549.0, "fp_pred_kg": 159646.0}, {"airline": "LH", "airport": "WAW", "month_order": 7, "month_name": "Jul", "actual_kg": 677604.0, "flt_pred_kg": 709501.0, "fp_pred_kg": 656147.0}, {"airline": "LH", "airport": "FRA", "month_order": 7, "month_name": "Jul", "actual_kg": 148414059.0, "flt_pred_kg": 148749973.0, "fp_pred_kg": 146214401.0}, {"airline": "LH", "airport": "HAM", "month_order": 7, "month_name": "Jul", "actual_kg": 1885789.0, "flt_pred_kg": 1881929.0, "fp_pred_kg": 1770205.0}, {"airline": "LH", "airport": "HKG", "month_order": 7, "month_name": "Jul", "actual_kg": 3324450.0, "flt_pred_kg": 3165688.0, "fp_pred_kg": 3569805.0}, {"airline": "LX", "airport": "HKG", "month_order": 7, "month_name": "Jul", "actual_kg": 3245544.0, "flt_pred_kg": 3371206.0, "fp_pred_kg": 3430398.0}, {"airline": "LX", "airport": "FRA", "month_order": 7, "month_name": "Jul", "actual_kg": 412710.0, "flt_pred_kg": 471675.0, "fp_pred_kg": 417024.0}, {"airline": "LX", "airport": "PMI", "month_order": 7, "month_name": "Jul", "actual_kg": 738467.0, "flt_pred_kg": 781829.0, "fp_pred_kg": 695617.0}, {"airline": "LX", "airport": "HAM", "month_order": 7, "month_name": "Jul", "actual_kg": 464950.0, "flt_pred_kg": 458694.0, "fp_pred_kg": 445261.0}, {"airline": "LX", "airport": "BLL", "month_order": 7, "month_name": "Jul", "actual_kg": 26999.0, "flt_pred_kg": 36215.0, "fp_pred_kg": 30770.0}, {"airline": "LX", "airport": "ORD", "month_order": 7, "month_name": "Jul", "actual_kg": 3052596.0, "flt_pred_kg": 3058406.0, "fp_pred_kg": 3283024.0}, {"airline": "LX", "airport": "VIE", "month_order": 7, "month_name": "Jul", "actual_kg": 256583.0, "flt_pred_kg": 280736.0, "fp_pred_kg": 247545.0}, {"airline": "LX", "airport": "WAW", "month_order": 7, "month_name": "Jul", "actual_kg": 222515.0, "flt_pred_kg": 196600.0, "fp_pred_kg": 205397.0}, {"airline": "OS", "airport": "PMI", "month_order": 7, "month_name": "Jul", "actual_kg": 499406.0, "flt_pred_kg": 433141.0, "fp_pred_kg": 454503.0}, {"airline": "OS", "airport": "HAM", "month_order": 7, "month_name": "Jul", "actual_kg": 446046.0, "flt_pred_kg": 408839.0, "fp_pred_kg": 429208.0}, {"airline": "OS", "airport": "ORD", "month_order": 7, "month_name": "Jul", "actual_kg": 1110355.0, "flt_pred_kg": 1106477.0, "fp_pred_kg": 1124552.0}, {"airline": "OS", "airport": "FRA", "month_order": 7, "month_name": "Jul", "actual_kg": 1025353.0, "flt_pred_kg": 1136658.0, "fp_pred_kg": 1071417.0}, {"airline": "OS", "airport": "VIE", "month_order": 7, "month_name": "Jul", "actual_kg": 38309263.0, "flt_pred_kg": 38524190.0, "fp_pred_kg": 38449508.0}, {"airline": "OS", "airport": "KEF", "month_order": 7, "month_name": "Jul", "actual_kg": 140585.0, "flt_pred_kg": 178739.0, "fp_pred_kg": 177678.0}, {"airline": "OS", "airport": "HRG", "month_order": 7, "month_name": "Jul", "actual_kg": 81846.0, "flt_pred_kg": 95812.0, "fp_pred_kg": 96282.0}, {"airline": "OS", "airport": "WAW", "month_order": 7, "month_name": "Jul", "actual_kg": 205172.0, "flt_pred_kg": 212614.0, "fp_pred_kg": 209856.0}, {"airline": "SN", "airport": "HAM", "month_order": 7, "month_name": "Jul", "actual_kg": 113122.0, "flt_pred_kg": 115440.0, "fp_pred_kg": 113210.0}, {"airline": "SN", "airport": "FRA", "month_order": 7, "month_name": "Jul", "actual_kg": 266595.0, "flt_pred_kg": 224616.0, "fp_pred_kg": 240387.0}, {"airline": "SN", "airport": "PMI", "month_order": 7, "month_name": "Jul", "actual_kg": 134811.0, "flt_pred_kg": 127385.0, "fp_pred_kg": 128318.0}, {"airline": "SN", "airport": "WAW", "month_order": 7, "month_name": "Jul", "actual_kg": 92837.0, "flt_pred_kg": 108117.0, "fp_pred_kg": 102519.0}, {"airline": "SN", "airport": "HRG", "month_order": 7, "month_name": "Jul", "actual_kg": 228714.0, "flt_pred_kg": 280281.0, "fp_pred_kg": 257242.0}, {"airline": "SN", "airport": "VIE", "month_order": 7, "month_name": "Jul", "actual_kg": 186239.0, "flt_pred_kg": 201621.0, "fp_pred_kg": 192859.0}, {"airline": "WK", "airport": "HRG", "month_order": 7, "month_name": "Jul", "actual_kg": 357462.0, "flt_pred_kg": 404219.0, "fp_pred_kg": 369345.0}, {"airline": "WK", "airport": "KEF", "month_order": 7, "month_name": "Jul", "actual_kg": 222249.0, "flt_pred_kg": 238068.0, "fp_pred_kg": 182970.0}, {"airline": "WK", "airport": "PMI", "month_order": 7, "month_name": "Jul", "actual_kg": 166598.0, "flt_pred_kg": 160087.0, "fp_pred_kg": 155104.0}, {"airline": "XQ", "airport": "KEF", "month_order": 7, "month_name": "Jul", "actual_kg": 15854.0, "flt_pred_kg": 18909.0, "fp_pred_kg": 0.0}, {"airline": "XQ", "airport": "VIE", "month_order": 7, "month_name": "Jul", "actual_kg": 1135489.0, "flt_pred_kg": 1145592.0, "fp_pred_kg": 1092073.0}, {"airline": "XQ", "airport": "HAM", "month_order": 7, "month_name": "Jul", "actual_kg": 1046506.0, "flt_pred_kg": 1274843.0, "fp_pred_kg": 1184239.0}, {"airline": "XQ", "airport": "FRA", "month_order": 7, "month_name": "Jul", "actual_kg": 2213364.0, "flt_pred_kg": 2253917.0, "fp_pred_kg": 2192967.0}, {"airline": "XQ", "airport": "BLL", "month_order": 7, "month_name": "Jul", "actual_kg": 121186.0, "flt_pred_kg": 117840.0, "fp_pred_kg": 126445.0}, {"airline": "XQ", "airport": "WAW", "month_order": 7, "month_name": "Jul", "actual_kg": 86237.0, "flt_pred_kg": 144377.0, "fp_pred_kg": 216369.0}, {"airline": "YF", "airport": "ORD", "month_order": 7, "month_name": "Jul", "actual_kg": 213076.0, "flt_pred_kg": 229785.0, "fp_pred_kg": 218716.0}, {"airline": "YF", "airport": "HKG", "month_order": 7, "month_name": "Jul", "actual_kg": 2058069.0, "flt_pred_kg": 1848426.0, "fp_pred_kg": 1912588.0}, {"airline": "YF", "airport": "FRA", "month_order": 7, "month_name": "Jul", "actual_kg": 20193039.0, "flt_pred_kg": 19446678.0, "fp_pred_kg": 20553256.0}, {"airline": "3S", "airport": "ORD", "month_order": 8, "month_name": "Aug", "actual_kg": 1487260.0, "flt_pred_kg": 1380542.0, "fp_pred_kg": 1476333.0}, {"airline": "3S", "airport": "FRA", "month_order": 8, "month_name": "Aug", "actual_kg": 11109359.0, "flt_pred_kg": 11051005.0, "fp_pred_kg": 10958741.0}, {"airline": "3S", "airport": "HKG", "month_order": 8, "month_name": "Aug", "actual_kg": 14026281.0, "flt_pred_kg": 13169043.0, "fp_pred_kg": 14272962.0}, {"airline": "4Y", "airport": "PMI", "month_order": 8, "month_name": "Aug", "actual_kg": 670274.0, "flt_pred_kg": 644458.0, "fp_pred_kg": 626070.0}, {"airline": "4Y", "airport": "FRA", "month_order": 8, "month_name": "Aug", "actual_kg": 20605798.0, "flt_pred_kg": 20388186.0, "fp_pred_kg": 19234009.0}, {"airline": "4Y", "airport": "KEF", "month_order": 8, "month_name": "Aug", "actual_kg": 89288.0, "flt_pred_kg": 71189.0, "fp_pred_kg": 123592.0}, {"airline": "4Y", "airport": "HRG", "month_order": 8, "month_name": "Aug", "actual_kg": 208907.0, "flt_pred_kg": 208341.0, "fp_pred_kg": 213966.0}, {"airline": "EN", "airport": "BLL", "month_order": 8, "month_name": "Aug", "actual_kg": 73693.0, "flt_pred_kg": 91471.0, "fp_pred_kg": 75547.0}, {"airline": "EN", "airport": "FRA", "month_order": 8, "month_name": "Aug", "actual_kg": 3061956.0, "flt_pred_kg": 3129154.0, "fp_pred_kg": 3055092.0}, {"airline": "EW", "airport": "PMI", "month_order": 8, "month_name": "Aug", "actual_kg": 10131217.0, "flt_pred_kg": 9357563.0, "fp_pred_kg": 9505387.0}, {"airline": "EW", "airport": "KEF", "month_order": 8, "month_name": "Aug", "actual_kg": 39085.0, "flt_pred_kg": 35440.0, "fp_pred_kg": 37683.0}, {"airline": "EW", "airport": "HRG", "month_order": 8, "month_name": "Aug", "actual_kg": 347280.0, "flt_pred_kg": 434960.0, "fp_pred_kg": 349562.0}, {"airline": "EW", "airport": "WAW", "month_order": 8, "month_name": "Aug", "actual_kg": 35368.0, "flt_pred_kg": 41615.0, "fp_pred_kg": 33030.0}, {"airline": "EW", "airport": "HAM", "month_order": 8, "month_name": "Aug", "actual_kg": 7261677.0, "flt_pred_kg": 7373081.0, "fp_pred_kg": 7020146.0}, {"airline": "EW", "airport": "VIE", "month_order": 8, "month_name": "Aug", "actual_kg": 718985.0, "flt_pred_kg": 745292.0, "fp_pred_kg": 738621.0}, {"airline": "EW", "airport": "FRA", "month_order": 8, "month_name": "Aug", "actual_kg": 68486.0, "flt_pred_kg": 68714.0, "fp_pred_kg": 73348.0}, {"airline": "LH", "airport": "PMI", "month_order": 8, "month_name": "Aug", "actual_kg": 499899.0, "flt_pred_kg": 463853.0, "fp_pred_kg": 450492.0}, {"airline": "LH", "airport": "BLL", "month_order": 8, "month_name": "Aug", "actual_kg": 376979.0, "flt_pred_kg": 347668.0, "fp_pred_kg": 489242.0}, {"airline": "LH", "airport": "ORD", "month_order": 8, "month_name": "Aug", "actual_kg": 6707233.0, "flt_pred_kg": 6622183.0, "fp_pred_kg": 6461133.0}, {"airline": "LH", "airport": "KEF", "month_order": 8, "month_name": "Aug", "actual_kg": 171735.0, "flt_pred_kg": 163741.0, "fp_pred_kg": 155710.0}, {"airline": "LH", "airport": "WAW", "month_order": 8, "month_name": "Aug", "actual_kg": 743216.0, "flt_pred_kg": 726603.0, "fp_pred_kg": 665927.0}, {"airline": "LH", "airport": "FRA", "month_order": 8, "month_name": "Aug", "actual_kg": 149748126.0, "flt_pred_kg": 148914833.0, "fp_pred_kg": 147780027.0}, {"airline": "LH", "airport": "VIE", "month_order": 8, "month_name": "Aug", "actual_kg": 95710.0, "flt_pred_kg": 75319.0, "fp_pred_kg": 87877.0}, {"airline": "LH", "airport": "HAM", "month_order": 8, "month_name": "Aug", "actual_kg": 1651948.0, "flt_pred_kg": 1651360.0, "fp_pred_kg": 1572139.0}, {"airline": "LH", "airport": "HKG", "month_order": 8, "month_name": "Aug", "actual_kg": 3621653.0, "flt_pred_kg": 3116699.0, "fp_pred_kg": 3569805.0}, {"airline": "LX", "airport": "HAM", "month_order": 8, "month_name": "Aug", "actual_kg": 431536.0, "flt_pred_kg": 420008.0, "fp_pred_kg": 430392.0}, {"airline": "LX", "airport": "FRA", "month_order": 8, "month_name": "Aug", "actual_kg": 466903.0, "flt_pred_kg": 482785.0, "fp_pred_kg": 436888.0}, {"airline": "LX", "airport": "BLL", "month_order": 8, "month_name": "Aug", "actual_kg": 12803.0, "flt_pred_kg": 19851.0, "fp_pred_kg": 18276.0}, {"airline": "LX", "airport": "VIE", "month_order": 8, "month_name": "Aug", "actual_kg": 252744.0, "flt_pred_kg": 250156.0, "fp_pred_kg": 242907.0}, {"airline": "LX", "airport": "PMI", "month_order": 8, "month_name": "Aug", "actual_kg": 777954.0, "flt_pred_kg": 735368.0, "fp_pred_kg": 684674.0}, {"airline": "LX", "airport": "WAW", "month_order": 8, "month_name": "Aug", "actual_kg": 218673.0, "flt_pred_kg": 199753.0, "fp_pred_kg": 200571.0}, {"airline": "LX", "airport": "ORD", "month_order": 8, "month_name": "Aug", "actual_kg": 3078439.0, "flt_pred_kg": 3069216.0, "fp_pred_kg": 3283024.0}, {"airline": "LX", "airport": "HKG", "month_order": 8, "month_name": "Aug", "actual_kg": 3267976.0, "flt_pred_kg": 3380351.0, "fp_pred_kg": 3430398.0}, {"airline": "OS", "airport": "ORD", "month_order": 8, "month_name": "Aug", "actual_kg": 1131134.0, "flt_pred_kg": 1197084.0, "fp_pred_kg": 1167804.0}, {"airline": "OS", "airport": "FRA", "month_order": 8, "month_name": "Aug", "actual_kg": 956392.0, "flt_pred_kg": 1126139.0, "fp_pred_kg": 1054870.0}, {"airline": "OS", "airport": "VIE", "month_order": 8, "month_name": "Aug", "actual_kg": 39683205.0, "flt_pred_kg": 38503384.0, "fp_pred_kg": 39214764.0}, {"airline": "OS", "airport": "HAM", "month_order": 8, "month_name": "Aug", "actual_kg": 415406.0, "flt_pred_kg": 391195.0, "fp_pred_kg": 410873.0}, {"airline": "OS", "airport": "PMI", "month_order": 8, "month_name": "Aug", "actual_kg": 502876.0, "flt_pred_kg": 444378.0, "fp_pred_kg": 459498.0}, {"airline": "OS", "airport": "HRG", "month_order": 8, "month_name": "Aug", "actual_kg": 85692.0, "flt_pred_kg": 94483.0, "fp_pred_kg": 96282.0}, {"airline": "OS", "airport": "WAW", "month_order": 8, "month_name": "Aug", "actual_kg": 212775.0, "flt_pred_kg": 210545.0, "fp_pred_kg": 206799.0}, {"airline": "OS", "airport": "KEF", "month_order": 8, "month_name": "Aug", "actual_kg": 156292.0, "flt_pred_kg": 192870.0, "fp_pred_kg": 199852.0}, {"airline": "SN", "airport": "PMI", "month_order": 8, "month_name": "Aug", "actual_kg": 131360.0, "flt_pred_kg": 125703.0, "fp_pred_kg": 122832.0}, {"airline": "SN", "airport": "HAM", "month_order": 8, "month_name": "Aug", "actual_kg": 115050.0, "flt_pred_kg": 116530.0, "fp_pred_kg": 110464.0}, {"airline": "SN", "airport": "WAW", "month_order": 8, "month_name": "Aug", "actual_kg": 107572.0, "flt_pred_kg": 104334.0, "fp_pred_kg": 98722.0}, {"airline": "SN", "airport": "HRG", "month_order": 8, "month_name": "Aug", "actual_kg": 210054.0, "flt_pred_kg": 265865.0, "fp_pred_kg": 244271.0}, {"airline": "SN", "airport": "FRA", "month_order": 8, "month_name": "Aug", "actual_kg": 283373.0, "flt_pred_kg": 188405.0, "fp_pred_kg": 203457.0}, {"airline": "SN", "airport": "VIE", "month_order": 8, "month_name": "Aug", "actual_kg": 194712.0, "flt_pred_kg": 222505.0, "fp_pred_kg": 192288.0}, {"airline": "WK", "airport": "HRG", "month_order": 8, "month_name": "Aug", "actual_kg": 312655.0, "flt_pred_kg": 414926.0, "fp_pred_kg": 369345.0}, {"airline": "WK", "airport": "KEF", "month_order": 8, "month_name": "Aug", "actual_kg": 178698.0, "flt_pred_kg": 221588.0, "fp_pred_kg": 167961.0}, {"airline": "WK", "airport": "PMI", "month_order": 8, "month_name": "Aug", "actual_kg": 187199.0, "flt_pred_kg": 182267.0, "fp_pred_kg": 171872.0}, {"airline": "XQ", "airport": "VIE", "month_order": 8, "month_name": "Aug", "actual_kg": 1136051.0, "flt_pred_kg": 1126947.0, "fp_pred_kg": 1086586.0}, {"airline": "XQ", "airport": "HAM", "month_order": 8, "month_name": "Aug", "actual_kg": 1053684.0, "flt_pred_kg": 1295762.0, "fp_pred_kg": 1217764.0}, {"airline": "XQ", "airport": "FRA", "month_order": 8, "month_name": "Aug", "actual_kg": 2145321.0, "flt_pred_kg": 2313820.0, "fp_pred_kg": 2231237.0}, {"airline": "XQ", "airport": "BLL", "month_order": 8, "month_name": "Aug", "actual_kg": 106770.0, "flt_pred_kg": 108131.0, "fp_pred_kg": 105017.0}, {"airline": "XQ", "airport": "WAW", "month_order": 8, "month_name": "Aug", "actual_kg": 98475.0, "flt_pred_kg": 146276.0, "fp_pred_kg": 211152.0}, {"airline": "YF", "airport": "ORD", "month_order": 8, "month_name": "Aug", "actual_kg": 114119.0, "flt_pred_kg": 162624.0, "fp_pred_kg": 164037.0}, {"airline": "YF", "airport": "HKG", "month_order": 8, "month_name": "Aug", "actual_kg": 1884876.0, "flt_pred_kg": 1654264.0, "fp_pred_kg": 1746276.0}, {"airline": "YF", "airport": "FRA", "month_order": 8, "month_name": "Aug", "actual_kg": 18238962.0, "flt_pred_kg": 18056274.0, "fp_pred_kg": 19244576.0}, {"airline": "3S", "airport": "VIE", "month_order": 9, "month_name": "Sep", "actual_kg": 6190.0, "flt_pred_kg": 9235.0, "fp_pred_kg": 0.0}, {"airline": "3S", "airport": "FRA", "month_order": 9, "month_name": "Sep", "actual_kg": 9906069.0, "flt_pred_kg": 10414850.0, "fp_pred_kg": 10082447.0}, {"airline": "3S", "airport": "ORD", "month_order": 9, "month_name": "Sep", "actual_kg": 1717131.0, "flt_pred_kg": 1332154.0, "fp_pred_kg": 1421654.0}, {"airline": "3S", "airport": "HKG", "month_order": 9, "month_name": "Sep", "actual_kg": 13369627.0, "flt_pred_kg": 13036545.0, "fp_pred_kg": 14480793.0}, {"airline": "4Y", "airport": "KEF", "month_order": 9, "month_name": "Sep", "actual_kg": 76439.0, "flt_pred_kg": 57662.0, "fp_pred_kg": 105936.0}, {"airline": "4Y", "airport": "VIE", "month_order": 9, "month_name": "Sep", "actual_kg": 3890.0, "flt_pred_kg": 12474.0, "fp_pred_kg": 0.0}, {"airline": "4Y", "airport": "PMI", "month_order": 9, "month_name": "Sep", "actual_kg": 606631.0, "flt_pred_kg": 682702.0, "fp_pred_kg": 595158.0}, {"airline": "4Y", "airport": "FRA", "month_order": 9, "month_name": "Sep", "actual_kg": 18562236.0, "flt_pred_kg": 17874515.0, "fp_pred_kg": 18389598.0}, {"airline": "4Y", "airport": "HRG", "month_order": 9, "month_name": "Sep", "actual_kg": 214249.0, "flt_pred_kg": 201455.0, "fp_pred_kg": 213966.0}, {"airline": "EN", "airport": "BLL", "month_order": 9, "month_name": "Sep", "actual_kg": 78027.0, "flt_pred_kg": 135003.0, "fp_pred_kg": 73110.0}, {"airline": "EN", "airport": "FRA", "month_order": 9, "month_name": "Sep", "actual_kg": 3074069.0, "flt_pred_kg": 3206114.0, "fp_pred_kg": 3067454.0}, {"airline": "EW", "airport": "PMI", "month_order": 9, "month_name": "Sep", "actual_kg": 9236240.0, "flt_pred_kg": 8703884.0, "fp_pred_kg": 8618647.0}, {"airline": "EW", "airport": "HAM", "month_order": 9, "month_name": "Sep", "actual_kg": 5978577.0, "flt_pred_kg": 7469130.0, "fp_pred_kg": 6730954.0}, {"airline": "EW", "airport": "KEF", "month_order": 9, "month_name": "Sep", "actual_kg": 10154.0, "flt_pred_kg": 25953.0, "fp_pred_kg": 37683.0}, {"airline": "EW", "airport": "WAW", "month_order": 9, "month_name": "Sep", "actual_kg": 60098.0, "flt_pred_kg": 85815.0, "fp_pred_kg": 66971.0}, {"airline": "EW", "airport": "VIE", "month_order": 9, "month_name": "Sep", "actual_kg": 1004134.0, "flt_pred_kg": 882932.0, "fp_pred_kg": 929092.0}, {"airline": "EW", "airport": "HRG", "month_order": 9, "month_name": "Sep", "actual_kg": 306690.0, "flt_pred_kg": 379243.0, "fp_pred_kg": 318504.0}, {"airline": "EW", "airport": "FRA", "month_order": 9, "month_name": "Sep", "actual_kg": 57673.0, "flt_pred_kg": 50677.0, "fp_pred_kg": 56696.0}, {"airline": "LH", "airport": "PMI", "month_order": 9, "month_name": "Sep", "actual_kg": 440060.0, "flt_pred_kg": 407153.0, "fp_pred_kg": 399853.0}, {"airline": "LH", "airport": "KEF", "month_order": 9, "month_name": "Sep", "actual_kg": 175382.0, "flt_pred_kg": 177959.0, "fp_pred_kg": 149524.0}, {"airline": "LH", "airport": "BLL", "month_order": 9, "month_name": "Sep", "actual_kg": 383693.0, "flt_pred_kg": 236006.0, "fp_pred_kg": 473460.0}, {"airline": "LH", "airport": "ORD", "month_order": 9, "month_name": "Sep", "actual_kg": 6052367.0, "flt_pred_kg": 6519357.0, "fp_pred_kg": 6031800.0}, {"airline": "LH", "airport": "VIE", "month_order": 9, "month_name": "Sep", "actual_kg": 83276.0, "flt_pred_kg": 68382.0, "fp_pred_kg": 82163.0}, {"airline": "LH", "airport": "HKG", "month_order": 9, "month_name": "Sep", "actual_kg": 3586922.0, "flt_pred_kg": 3233338.0, "fp_pred_kg": 3454650.0}, {"airline": "LH", "airport": "FRA", "month_order": 9, "month_name": "Sep", "actual_kg": 141580572.0, "flt_pred_kg": 141885554.0, "fp_pred_kg": 141623352.0}, {"airline": "LH", "airport": "HAM", "month_order": 9, "month_name": "Sep", "actual_kg": 1523252.0, "flt_pred_kg": 1778687.0, "fp_pred_kg": 1857059.0}, {"airline": "LH", "airport": "WAW", "month_order": 9, "month_name": "Sep", "actual_kg": 660332.0, "flt_pred_kg": 686409.0, "fp_pred_kg": 632964.0}, {"airline": "LX", "airport": "VIE", "month_order": 9, "month_name": "Sep", "actual_kg": 247943.0, "flt_pred_kg": 250632.0, "fp_pred_kg": 235337.0}, {"airline": "LX", "airport": "HAM", "month_order": 9, "month_name": "Sep", "actual_kg": 326003.0, "flt_pred_kg": 381439.0, "fp_pred_kg": 425666.0}, {"airline": "LX", "airport": "PMI", "month_order": 9, "month_name": "Sep", "actual_kg": 664640.0, "flt_pred_kg": 675407.0, "fp_pred_kg": 634995.0}, {"airline": "LX", "airport": "WAW", "month_order": 9, "month_name": "Sep", "actual_kg": 233918.0, "flt_pred_kg": 220750.0, "fp_pred_kg": 201568.0}, {"airline": "LX", "airport": "FRA", "month_order": 9, "month_name": "Sep", "actual_kg": 443964.0, "flt_pred_kg": 467715.0, "fp_pred_kg": 461935.0}, {"airline": "LX", "airport": "HKG", "month_order": 9, "month_name": "Sep", "actual_kg": 3054473.0, "flt_pred_kg": 3283136.0, "fp_pred_kg": 3319740.0}, {"airline": "LX", "airport": "ORD", "month_order": 9, "month_name": "Sep", "actual_kg": 1749472.0, "flt_pred_kg": 1797829.0, "fp_pred_kg": 1839870.0}, {"airline": "OS", "airport": "VIE", "month_order": 9, "month_name": "Sep", "actual_kg": 37439819.0, "flt_pred_kg": 37086047.0, "fp_pred_kg": 37133573.0}, {"airline": "OS", "airport": "PMI", "month_order": 9, "month_name": "Sep", "actual_kg": 447707.0, "flt_pred_kg": 416106.0, "fp_pred_kg": 417367.0}, {"airline": "OS", "airport": "WAW", "month_order": 9, "month_name": "Sep", "actual_kg": 192773.0, "flt_pred_kg": 210478.0, "fp_pred_kg": 202692.0}, {"airline": "OS", "airport": "FRA", "month_order": 9, "month_name": "Sep", "actual_kg": 973449.0, "flt_pred_kg": 1073803.0, "fp_pred_kg": 1039893.0}, {"airline": "OS", "airport": "HRG", "month_order": 9, "month_name": "Sep", "actual_kg": 75770.0, "flt_pred_kg": 84608.0, "fp_pred_kg": 85584.0}, {"airline": "OS", "airport": "KEF", "month_order": 9, "month_name": "Sep", "actual_kg": 79380.0, "flt_pred_kg": 105712.0, "fp_pred_kg": 94624.0}, {"airline": "OS", "airport": "ORD", "month_order": 9, "month_name": "Sep", "actual_kg": 1127796.0, "flt_pred_kg": 1128864.0, "fp_pred_kg": 1124552.0}, {"airline": "OS", "airport": "HAM", "month_order": 9, "month_name": "Sep", "actual_kg": 350073.0, "flt_pred_kg": 417760.0, "fp_pred_kg": 412294.0}, {"airline": "SN", "airport": "FRA", "month_order": 9, "month_name": "Sep", "actual_kg": 263424.0, "flt_pred_kg": 198329.0, "fp_pred_kg": 225819.0}, {"airline": "SN", "airport": "WAW", "month_order": 9, "month_name": "Sep", "actual_kg": 197470.0, "flt_pred_kg": 201139.0, "fp_pred_kg": 198296.0}, {"airline": "SN", "airport": "PMI", "month_order": 9, "month_name": "Sep", "actual_kg": 105648.0, "flt_pred_kg": 99838.0, "fp_pred_kg": 100006.0}, {"airline": "SN", "airport": "HRG", "month_order": 9, "month_name": "Sep", "actual_kg": 145424.0, "flt_pred_kg": 176508.0, "fp_pred_kg": 157284.0}, {"airline": "SN", "airport": "HAM", "month_order": 9, "month_name": "Sep", "actual_kg": 87193.0, "flt_pred_kg": 109699.0, "fp_pred_kg": 110917.0}, {"airline": "SN", "airport": "VIE", "month_order": 9, "month_name": "Sep", "actual_kg": 262977.0, "flt_pred_kg": 280723.0, "fp_pred_kg": 287726.0}, {"airline": "WK", "airport": "KEF", "month_order": 9, "month_name": "Sep", "actual_kg": 94844.0, "flt_pred_kg": 92928.0, "fp_pred_kg": 90057.0}, {"airline": "WK", "airport": "HRG", "month_order": 9, "month_name": "Sep", "actual_kg": 331396.0, "flt_pred_kg": 373061.0, "fp_pred_kg": 387186.0}, {"airline": "WK", "airport": "PMI", "month_order": 9, "month_name": "Sep", "actual_kg": 166011.0, "flt_pred_kg": 164966.0, "fp_pred_kg": 159296.0}, {"airline": "WK", "airport": "BLL", "month_order": 9, "month_name": "Sep", "actual_kg": 2928.0, "flt_pred_kg": 2150.0, "fp_pred_kg": 3046.0}, {"airline": "XQ", "airport": "FRA", "month_order": 9, "month_name": "Sep", "actual_kg": 2231660.0, "flt_pred_kg": 2338805.0, "fp_pred_kg": 2177136.0}, {"airline": "XQ", "airport": "WAW", "month_order": 9, "month_name": "Sep", "actual_kg": 98493.0, "flt_pred_kg": 206886.0, "fp_pred_kg": 210096.0}, {"airline": "XQ", "airport": "HAM", "month_order": 9, "month_name": "Sep", "actual_kg": 886838.0, "flt_pred_kg": 1153872.0, "fp_pred_kg": 1103569.0}, {"airline": "XQ", "airport": "BLL", "month_order": 9, "month_name": "Sep", "actual_kg": 105017.0, "flt_pred_kg": 110068.0, "fp_pred_kg": 103264.0}, {"airline": "XQ", "airport": "VIE", "month_order": 9, "month_name": "Sep", "actual_kg": 895945.0, "flt_pred_kg": 930676.0, "fp_pred_kg": 886914.0}, {"airline": "YF", "airport": "FRA", "month_order": 9, "month_name": "Sep", "actual_kg": 18061791.0, "flt_pred_kg": 16649191.0, "fp_pred_kg": 17027643.0}, {"airline": "YF", "airport": "HKG", "month_order": 9, "month_name": "Sep", "actual_kg": 1746081.0, "flt_pred_kg": 1534962.0, "fp_pred_kg": 1330496.0}, {"airline": "YF", "airport": "ORD", "month_order": 9, "month_name": "Sep", "actual_kg": 161985.0, "flt_pred_kg": 211467.0, "fp_pred_kg": 218716.0}, {"airline": "3S", "airport": "FRA", "month_order": 10, "month_name": "Oct", "actual_kg": 10273338.0, "flt_pred_kg": 9720159.0, "fp_pred_kg": 8590286.0}, {"airline": "3S", "airport": "ORD", "month_order": 10, "month_name": "Oct", "actual_kg": 1976687.0, "flt_pred_kg": 1366044.0, "fp_pred_kg": 1093580.0}, {"airline": "3S", "airport": "HKG", "month_order": 10, "month_name": "Oct", "actual_kg": 16980900.0, "flt_pred_kg": 12671121.0, "fp_pred_kg": 11973528.0}, {"airline": "4Y", "airport": "KEF", "month_order": 10, "month_name": "Oct", "actual_kg": 59577.0, "flt_pred_kg": 47056.0, "fp_pred_kg": 88468.0}, {"airline": "4Y", "airport": "VIE", "month_order": 10, "month_name": "Oct", "actual_kg": 4517.0, "flt_pred_kg": 3547.0, "fp_pred_kg": 0.0}, {"airline": "4Y", "airport": "PMI", "month_order": 10, "month_name": "Oct", "actual_kg": 622051.0, "flt_pred_kg": 637141.0, "fp_pred_kg": 596527.0}, {"airline": "4Y", "airport": "FRA", "month_order": 10, "month_name": "Oct", "actual_kg": 17647935.0, "flt_pred_kg": 16615024.0, "fp_pred_kg": 17481492.0}, {"airline": "4Y", "airport": "HRG", "month_order": 10, "month_name": "Oct", "actual_kg": 263845.0, "flt_pred_kg": 250594.0, "fp_pred_kg": 264286.0}, {"airline": "EN", "airport": "BLL", "month_order": 10, "month_name": "Oct", "actual_kg": 59426.0, "flt_pred_kg": 130371.0, "fp_pred_kg": 60925.0}, {"airline": "EN", "airport": "FRA", "month_order": 10, "month_name": "Oct", "actual_kg": 3068834.0, "flt_pred_kg": 2990059.0, "fp_pred_kg": 2905232.0}, {"airline": "EW", "airport": "PMI", "month_order": 10, "month_name": "Oct", "actual_kg": 9266210.0, "flt_pred_kg": 8594188.0, "fp_pred_kg": 8147872.0}, {"airline": "EW", "airport": "HAM", "month_order": 10, "month_name": "Oct", "actual_kg": 7269159.0, "flt_pred_kg": 7311408.0, "fp_pred_kg": 6993607.0}, {"airline": "EW", "airport": "WAW", "month_order": 10, "month_name": "Oct", "actual_kg": 63820.0, "flt_pred_kg": 84152.0, "fp_pred_kg": 51367.0}, {"airline": "EW", "airport": "VIE", "month_order": 10, "month_name": "Oct", "actual_kg": 899026.0, "flt_pred_kg": 847488.0, "fp_pred_kg": 864954.0}, {"airline": "EW", "airport": "HRG", "month_order": 10, "month_name": "Oct", "actual_kg": 654879.0, "flt_pred_kg": 659462.0, "fp_pred_kg": 652350.0}, {"airline": "EW", "airport": "FRA", "month_order": 10, "month_name": "Oct", "actual_kg": 40767.0, "flt_pred_kg": 61146.0, "fp_pred_kg": 53524.0}, {"airline": "LH", "airport": "PMI", "month_order": 10, "month_name": "Oct", "actual_kg": 383549.0, "flt_pred_kg": 361008.0, "fp_pred_kg": 379783.0}, {"airline": "LH", "airport": "KEF", "month_order": 10, "month_name": "Oct", "actual_kg": 145654.0, "flt_pred_kg": 193854.0, "fp_pred_kg": 147084.0}, {"airline": "LH", "airport": "BLL", "month_order": 10, "month_name": "Oct", "actual_kg": 355707.0, "flt_pred_kg": 209746.0, "fp_pred_kg": 451865.0}, {"airline": "LH", "airport": "ORD", "month_order": 10, "month_name": "Oct", "actual_kg": 6051274.0, "flt_pred_kg": 5889248.0, "fp_pred_kg": 5823755.0}, {"airline": "LH", "airport": "VIE", "month_order": 10, "month_name": "Oct", "actual_kg": 87885.0, "flt_pred_kg": 79194.0, "fp_pred_kg": 95330.0}, {"airline": "LH", "airport": "HKG", "month_order": 10, "month_name": "Oct", "actual_kg": 3367137.0, "flt_pred_kg": 3812496.0, "fp_pred_kg": 3749823.0}, {"airline": "LH", "airport": "FRA", "month_order": 10, "month_name": "Oct", "actual_kg": 139814113.0, "flt_pred_kg": 139932775.0, "fp_pred_kg": 142220971.0}, {"airline": "LH", "airport": "HAM", "month_order": 10, "month_name": "Oct", "actual_kg": 1952037.0, "flt_pred_kg": 1793641.0, "fp_pred_kg": 1880886.0}, {"airline": "LH", "airport": "WAW", "month_order": 10, "month_name": "Oct", "actual_kg": 681351.0, "flt_pred_kg": 677460.0, "fp_pred_kg": 639855.0}, {"airline": "LX", "airport": "VIE", "month_order": 10, "month_name": "Oct", "actual_kg": 210556.0, "flt_pred_kg": 212048.0, "fp_pred_kg": 247091.0}, {"airline": "LX", "airport": "HAM", "month_order": 10, "month_name": "Oct", "actual_kg": 407123.0, "flt_pred_kg": 414481.0, "fp_pred_kg": 415588.0}, {"airline": "LX", "airport": "PMI", "month_order": 10, "month_name": "Oct", "actual_kg": 710245.0, "flt_pred_kg": 683510.0, "fp_pred_kg": 595025.0}, {"airline": "LX", "airport": "WAW", "month_order": 10, "month_name": "Oct", "actual_kg": 235006.0, "flt_pred_kg": 212791.0, "fp_pred_kg": 220871.0}, {"airline": "LX", "airport": "FRA", "month_order": 10, "month_name": "Oct", "actual_kg": 364327.0, "flt_pred_kg": 370122.0, "fp_pred_kg": 410596.0}, {"airline": "LX", "airport": "HKG", "month_order": 10, "month_name": "Oct", "actual_kg": 3471518.0, "flt_pred_kg": 3426963.0, "fp_pred_kg": 3430398.0}, {"airline": "LX", "airport": "ORD", "month_order": 10, "month_name": "Oct", "actual_kg": 1790714.0, "flt_pred_kg": 1796788.0, "fp_pred_kg": 1800675.0}, {"airline": "OS", "airport": "VIE", "month_order": 10, "month_name": "Oct", "actual_kg": 36604937.0, "flt_pred_kg": 35807888.0, "fp_pred_kg": 36153971.0}, {"airline": "OS", "airport": "PMI", "month_order": 10, "month_name": "Oct", "actual_kg": 436286.0, "flt_pred_kg": 417120.0, "fp_pred_kg": 390039.0}, {"airline": "OS", "airport": "WAW", "month_order": 10, "month_name": "Oct", "actual_kg": 198273.0, "flt_pred_kg": 227256.0, "fp_pred_kg": 213129.0}, {"airline": "OS", "airport": "FRA", "month_order": 10, "month_name": "Oct", "actual_kg": 947834.0, "flt_pred_kg": 1069603.0, "fp_pred_kg": 1089272.0}, {"airline": "OS", "airport": "HAM", "month_order": 10, "month_name": "Oct", "actual_kg": 418491.0, "flt_pred_kg": 430981.0, "fp_pred_kg": 424813.0}, {"airline": "OS", "airport": "KEF", "month_order": 10, "month_name": "Oct", "actual_kg": 68831.0, "flt_pred_kg": 88698.0, "fp_pred_kg": 71544.0}, {"airline": "OS", "airport": "HRG", "month_order": 10, "month_name": "Oct", "actual_kg": 127327.0, "flt_pred_kg": 136667.0, "fp_pred_kg": 139074.0}, {"airline": "OS", "airport": "ORD", "month_order": 10, "month_name": "Oct", "actual_kg": 1050346.0, "flt_pred_kg": 1033262.0, "fp_pred_kg": 1047991.0}, {"airline": "SN", "airport": "HRG", "month_order": 10, "month_name": "Oct", "actual_kg": 153939.0, "flt_pred_kg": 196654.0, "fp_pred_kg": 187426.0}, {"airline": "SN", "airport": "WAW", "month_order": 10, "month_name": "Oct", "actual_kg": 163691.0, "flt_pred_kg": 225483.0, "fp_pred_kg": 224307.0}, {"airline": "SN", "airport": "PMI", "month_order": 10, "month_name": "Oct", "actual_kg": 60853.0, "flt_pred_kg": 64029.0, "fp_pred_kg": 54800.0}, {"airline": "SN", "airport": "FRA", "month_order": 10, "month_name": "Oct", "actual_kg": 250275.0, "flt_pred_kg": 194112.0, "fp_pred_kg": 230506.0}, {"airline": "SN", "airport": "HAM", "month_order": 10, "month_name": "Oct", "actual_kg": 113031.0, "flt_pred_kg": 116815.0, "fp_pred_kg": 116658.0}, {"airline": "SN", "airport": "VIE", "month_order": 10, "month_name": "Oct", "actual_kg": 279901.0, "flt_pred_kg": 285044.0, "fp_pred_kg": 294268.0}, {"airline": "WK", "airport": "KEF", "month_order": 10, "month_name": "Oct", "actual_kg": 60759.0, "flt_pred_kg": 72971.0, "fp_pred_kg": 65496.0}, {"airline": "WK", "airport": "HRG", "month_order": 10, "month_name": "Oct", "actual_kg": 407231.0, "flt_pred_kg": 487620.0, "fp_pred_kg": 517101.0}, {"airline": "WK", "airport": "PMI", "month_order": 10, "month_name": "Oct", "actual_kg": 163288.0, "flt_pred_kg": 181466.0, "fp_pred_kg": 150912.0}, {"airline": "XQ", "airport": "VIE", "month_order": 10, "month_name": "Oct", "actual_kg": 705018.0, "flt_pred_kg": 676552.0, "fp_pred_kg": 647153.0}, {"airline": "XQ", "airport": "WAW", "month_order": 10, "month_name": "Oct", "actual_kg": 142440.0, "flt_pred_kg": 249691.0, "fp_pred_kg": 212854.0}, {"airline": "XQ", "airport": "BLL", "month_order": 10, "month_name": "Oct", "actual_kg": 88456.0, "flt_pred_kg": 100795.0, "fp_pred_kg": 107072.0}, {"airline": "XQ", "airport": "HAM", "month_order": 10, "month_name": "Oct", "actual_kg": 1266647.0, "flt_pred_kg": 1275273.0, "fp_pred_kg": 1228326.0}, {"airline": "XQ", "airport": "FRA", "month_order": 10, "month_name": "Oct", "actual_kg": 2103622.0, "flt_pred_kg": 2279326.0, "fp_pred_kg": 2116746.0}, {"airline": "YF", "airport": "ORD", "month_order": 10, "month_name": "Oct", "actual_kg": 277688.0, "flt_pred_kg": 265168.0, "fp_pred_kg": 164037.0}, {"airline": "YF", "airport": "FRA", "month_order": 10, "month_name": "Oct", "actual_kg": 18650143.0, "flt_pred_kg": 16547078.0, "fp_pred_kg": 14695551.0}, {"airline": "YF", "airport": "HKG", "month_order": 10, "month_name": "Oct", "actual_kg": 1995722.0, "flt_pred_kg": 1811553.0, "fp_pred_kg": 1247340.0}, {"airline": "4Y", "airport": "KEF", "month_order": 11, "month_name": "Nov", "actual_kg": 53468.0, "flt_pred_kg": 40899.0, "fp_pred_kg": 81144.0}, {"airline": "4Y", "airport": "FRA", "month_order": 11, "month_name": "Nov", "actual_kg": 15201798.0, "flt_pred_kg": 15416278.0, "fp_pred_kg": 16136523.0}, {"airline": "4Y", "airport": "PMI", "month_order": 11, "month_name": "Nov", "actual_kg": 471457.0, "flt_pred_kg": 463862.0, "fp_pred_kg": 463835.0}, {"airline": "4Y", "airport": "HRG", "month_order": 11, "month_name": "Nov", "actual_kg": 510698.0, "flt_pred_kg": 531639.0, "fp_pred_kg": 545310.0}, {"airline": "EN", "airport": "FRA", "month_order": 11, "month_name": "Nov", "actual_kg": 2772713.0, "flt_pred_kg": 1923694.0, "fp_pred_kg": 1699517.0}, {"airline": "EW", "airport": "FRA", "month_order": 11, "month_name": "Nov", "actual_kg": 55830.0, "flt_pred_kg": 50002.0, "fp_pred_kg": 60660.0}, {"airline": "EW", "airport": "VIE", "month_order": 11, "month_name": "Nov", "actual_kg": 734306.0, "flt_pred_kg": 392092.0, "fp_pred_kg": 672286.0}, {"airline": "EW", "airport": "PMI", "month_order": 11, "month_name": "Nov", "actual_kg": 2468573.0, "flt_pred_kg": 1714250.0, "fp_pred_kg": 2511182.0}, {"airline": "EW", "airport": "HAM", "month_order": 11, "month_name": "Nov", "actual_kg": 5075418.0, "flt_pred_kg": 3536036.0, "fp_pred_kg": 4705229.0}, {"airline": "EW", "airport": "HRG", "month_order": 11, "month_name": "Nov", "actual_kg": 1695015.0, "flt_pred_kg": 1416065.0, "fp_pred_kg": 1689899.0}, {"airline": "LH", "airport": "WAW", "month_order": 11, "month_name": "Nov", "actual_kg": 580905.0, "flt_pred_kg": 535347.0, "fp_pred_kg": 560508.0}, {"airline": "LH", "airport": "VIE", "month_order": 11, "month_name": "Nov", "actual_kg": 80017.0, "flt_pred_kg": 37620.0, "fp_pred_kg": 94962.0}, {"airline": "LH", "airport": "PMI", "month_order": 11, "month_name": "Nov", "actual_kg": 116351.0, "flt_pred_kg": 84140.0, "fp_pred_kg": 148381.0}, {"airline": "LH", "airport": "ORD", "month_order": 11, "month_name": "Nov", "actual_kg": 4587041.0, "flt_pred_kg": 4485818.0, "fp_pred_kg": 5019360.0}, {"airline": "LH", "airport": "KEF", "month_order": 11, "month_name": "Nov", "actual_kg": 69470.0, "flt_pred_kg": 53318.0, "fp_pred_kg": 80994.0}, {"airline": "LH", "airport": "HKG", "month_order": 11, "month_name": "Nov", "actual_kg": 2431913.0, "flt_pred_kg": 5057186.0, "fp_pred_kg": 4354740.0}, {"airline": "LH", "airport": "BLL", "month_order": 11, "month_name": "Nov", "actual_kg": 290983.0, "flt_pred_kg": 216002.0, "fp_pred_kg": 278015.0}, {"airline": "LH", "airport": "FRA", "month_order": 11, "month_name": "Nov", "actual_kg": 123786629.0, "flt_pred_kg": 124574221.0, "fp_pred_kg": 127004399.0}, {"airline": "LH", "airport": "HAM", "month_order": 11, "month_name": "Nov", "actual_kg": 1795025.0, "flt_pred_kg": 1609078.0, "fp_pred_kg": 1589132.0}, {"airline": "LX", "airport": "HKG", "month_order": 11, "month_name": "Nov", "actual_kg": 3251665.0, "flt_pred_kg": 3352608.0, "fp_pred_kg": 3319740.0}, {"airline": "LX", "airport": "WAW", "month_order": 11, "month_name": "Nov", "actual_kg": 196784.0, "flt_pred_kg": 177772.0, "fp_pred_kg": 221480.0}, {"airline": "LX", "airport": "FRA", "month_order": 11, "month_name": "Nov", "actual_kg": 120202.0, "flt_pred_kg": 93637.0, "fp_pred_kg": 130207.0}, {"airline": "LX", "airport": "HAM", "month_order": 11, "month_name": "Nov", "actual_kg": 369965.0, "flt_pred_kg": 353090.0, "fp_pred_kg": 412285.0}, {"airline": "LX", "airport": "ORD", "month_order": 11, "month_name": "Nov", "actual_kg": 1335241.0, "flt_pred_kg": 1211440.0, "fp_pred_kg": 1337250.0}, {"airline": "LX", "airport": "PMI", "month_order": 11, "month_name": "Nov", "actual_kg": 224658.0, "flt_pred_kg": 159812.0, "fp_pred_kg": 171993.0}, {"airline": "OS", "airport": "WAW", "month_order": 11, "month_name": "Nov", "actual_kg": 178057.0, "flt_pred_kg": 186782.0, "fp_pred_kg": 179100.0}, {"airline": "OS", "airport": "VIE", "month_order": 11, "month_name": "Nov", "actual_kg": 27143938.0, "flt_pred_kg": 27078477.0, "fp_pred_kg": 27260286.0}, {"airline": "OS", "airport": "PMI", "month_order": 11, "month_name": "Nov", "actual_kg": 183866.0, "flt_pred_kg": 178193.0, "fp_pred_kg": 170976.0}, {"airline": "OS", "airport": "FRA", "month_order": 11, "month_name": "Nov", "actual_kg": 932640.0, "flt_pred_kg": 962019.0, "fp_pred_kg": 1056525.0}, {"airline": "OS", "airport": "ORD", "month_order": 11, "month_name": "Nov", "actual_kg": 738024.0, "flt_pred_kg": 724441.0, "fp_pred_kg": 824771.0}, {"airline": "OS", "airport": "HAM", "month_order": 11, "month_name": "Nov", "actual_kg": 351624.0, "flt_pred_kg": 331734.0, "fp_pred_kg": 352086.0}, {"airline": "OS", "airport": "HRG", "month_order": 11, "month_name": "Nov", "actual_kg": 135690.0, "flt_pred_kg": 148284.0, "fp_pred_kg": 149772.0}, {"airline": "SN", "airport": "FRA", "month_order": 11, "month_name": "Nov", "actual_kg": 243807.0, "flt_pred_kg": 137944.0, "fp_pred_kg": 234699.0}, {"airline": "SN", "airport": "HAM", "month_order": 11, "month_name": "Nov", "actual_kg": 90591.0, "flt_pred_kg": 100378.0, "fp_pred_kg": 108524.0}, {"airline": "SN", "airport": "VIE", "month_order": 11, "month_name": "Nov", "actual_kg": 287345.0, "flt_pred_kg": 231543.0, "fp_pred_kg": 298541.0}, {"airline": "SN", "airport": "HRG", "month_order": 11, "month_name": "Nov", "actual_kg": 245938.0, "flt_pred_kg": 240749.0, "fp_pred_kg": 262957.0}, {"airline": "SN", "airport": "PMI", "month_order": 11, "month_name": "Nov", "actual_kg": 9224.0, "flt_pred_kg": 7990.0, "fp_pred_kg": 9452.0}, {"airline": "SN", "airport": "WAW", "month_order": 11, "month_name": "Nov", "actual_kg": 150106.0, "flt_pred_kg": 255738.0, "fp_pred_kg": 268994.0}, {"airline": "WK", "airport": "HRG", "month_order": 11, "month_name": "Nov", "actual_kg": 454774.0, "flt_pred_kg": 500889.0, "fp_pred_kg": 528792.0}, {"airline": "WK", "airport": "PMI", "month_order": 11, "month_name": "Nov", "actual_kg": 77206.0, "flt_pred_kg": 82727.0, "fp_pred_kg": 79648.0}, {"airline": "WK", "airport": "KEF", "month_order": 11, "month_name": "Nov", "actual_kg": 52745.0, "flt_pred_kg": 53483.0, "fp_pred_kg": 49122.0}, {"airline": "XQ", "airport": "FRA", "month_order": 11, "month_name": "Nov", "actual_kg": 1091470.0, "flt_pred_kg": 1275320.0, "fp_pred_kg": 1207707.0}, {"airline": "XQ", "airport": "VIE", "month_order": 11, "month_name": "Nov", "actual_kg": 378822.0, "flt_pred_kg": 401492.0, "fp_pred_kg": 386785.0}, {"airline": "XQ", "airport": "BLL", "month_order": 11, "month_name": "Nov", "actual_kg": 18314.0, "flt_pred_kg": 26093.0, "fp_pred_kg": 37232.0}, {"airline": "XQ", "airport": "HAM", "month_order": 11, "month_name": "Nov", "actual_kg": 576595.0, "flt_pred_kg": 649964.0, "fp_pred_kg": 598416.0}, {"airline": "XQ", "airport": "WAW", "month_order": 11, "month_name": "Nov", "actual_kg": 144692.0, "flt_pred_kg": 147978.0, "fp_pred_kg": 156074.0}, {"airline": "4Y", "airport": "FRA", "month_order": 12, "month_name": "Dec", "actual_kg": 16445036.0, "flt_pred_kg": 16030985.0, "fp_pred_kg": 16996946.0}, {"airline": "4Y", "airport": "PMI", "month_order": 12, "month_name": "Dec", "actual_kg": 439059.0, "flt_pred_kg": 445974.0, "fp_pred_kg": 477740.0}, {"airline": "4Y", "airport": "KEF", "month_order": 12, "month_name": "Dec", "actual_kg": 55299.0, "flt_pred_kg": 51356.0, "fp_pred_kg": 90160.0}, {"airline": "4Y", "airport": "HRG", "month_order": 12, "month_name": "Dec", "actual_kg": 342526.0, "flt_pred_kg": 523341.0, "fp_pred_kg": 543924.0}, {"airline": "EN", "airport": "FRA", "month_order": 12, "month_name": "Dec", "actual_kg": 2797112.0, "flt_pred_kg": 1951292.0, "fp_pred_kg": 1671668.0}, {"airline": "EW", "airport": "BLL", "month_order": 12, "month_name": "Dec", "actual_kg": 6999.0, "flt_pred_kg": 2322.0, "fp_pred_kg": 4786.0}, {"airline": "EW", "airport": "VIE", "month_order": 12, "month_name": "Dec", "actual_kg": 584079.0, "flt_pred_kg": 363822.0, "fp_pred_kg": 624106.0}, {"airline": "EW", "airport": "PMI", "month_order": 12, "month_name": "Dec", "actual_kg": 1869990.0, "flt_pred_kg": 1399187.0, "fp_pred_kg": 2080042.0}, {"airline": "EW", "airport": "HAM", "month_order": 12, "month_name": "Dec", "actual_kg": 4451701.0, "flt_pred_kg": 3479689.0, "fp_pred_kg": 4433593.0}, {"airline": "EW", "airport": "HRG", "month_order": 12, "month_name": "Dec", "actual_kg": 1587184.0, "flt_pred_kg": 1306015.0, "fp_pred_kg": 1591447.0}, {"airline": "EW", "airport": "FRA", "month_order": 12, "month_name": "Dec", "actual_kg": 83128.0, "flt_pred_kg": 48607.0, "fp_pred_kg": 60660.0}, {"airline": "LH", "airport": "KEF", "month_order": 12, "month_name": "Dec", "actual_kg": 65676.0, "flt_pred_kg": 51033.0, "fp_pred_kg": 80994.0}, {"airline": "LH", "airport": "HAM", "month_order": 12, "month_name": "Dec", "actual_kg": 1755592.0, "flt_pred_kg": 1430486.0, "fp_pred_kg": 1536528.0}, {"airline": "LH", "airport": "WAW", "month_order": 12, "month_name": "Dec", "actual_kg": 497601.0, "flt_pred_kg": 469031.0, "fp_pred_kg": 537545.0}, {"airline": "LH", "airport": "VIE", "month_order": 12, "month_name": "Dec", "actual_kg": 47468.0, "flt_pred_kg": 30636.0, "fp_pred_kg": 72812.0}, {"airline": "LH", "airport": "BLL", "month_order": 12, "month_name": "Dec", "actual_kg": 206878.0, "flt_pred_kg": 162804.0, "fp_pred_kg": 205248.0}, {"airline": "LH", "airport": "FRA", "month_order": 12, "month_name": "Dec", "actual_kg": 120978491.0, "flt_pred_kg": 121814930.0, "fp_pred_kg": 127073455.0}, {"airline": "LH", "airport": "HKG", "month_order": 12, "month_name": "Dec", "actual_kg": 2308654.0, "flt_pred_kg": 5156516.0, "fp_pred_kg": 4348762.0}, {"airline": "LH", "airport": "ORD", "month_order": 12, "month_name": "Dec", "actual_kg": 4880532.0, "flt_pred_kg": 4153144.0, "fp_pred_kg": 5186672.0}, {"airline": "LH", "airport": "PMI", "month_order": 12, "month_name": "Dec", "actual_kg": 76202.0, "flt_pred_kg": 45545.0, "fp_pred_kg": 112064.0}, {"airline": "LX", "airport": "FRA", "month_order": 12, "month_name": "Dec", "actual_kg": 127479.0, "flt_pred_kg": 103737.0, "fp_pred_kg": 136010.0}, {"airline": "LX", "airport": "ORD", "month_order": 12, "month_name": "Dec", "actual_kg": 1392761.0, "flt_pred_kg": 1264967.0, "fp_pred_kg": 1381825.0}, {"airline": "LX", "airport": "HKG", "month_order": 12, "month_name": "Dec", "actual_kg": 3421402.0, "flt_pred_kg": 3470540.0, "fp_pred_kg": 3430398.0}, {"airline": "LX", "airport": "WAW", "month_order": 12, "month_name": "Dec", "actual_kg": 195266.0, "flt_pred_kg": 179608.0, "fp_pred_kg": 237104.0}, {"airline": "LX", "airport": "HAM", "month_order": 12, "month_name": "Dec", "actual_kg": 376706.0, "flt_pred_kg": 371359.0, "fp_pred_kg": 426988.0}, {"airline": "LX", "airport": "PMI", "month_order": 12, "month_name": "Dec", "actual_kg": 182761.0, "flt_pred_kg": 141550.0, "fp_pred_kg": 167050.0}, {"airline": "OS", "airport": "PMI", "month_order": 12, "month_name": "Dec", "actual_kg": 173924.0, "flt_pred_kg": 159514.0, "fp_pred_kg": 160290.0}, {"airline": "OS", "airport": "VIE", "month_order": 12, "month_name": "Dec", "actual_kg": 26945374.0, "flt_pred_kg": 27833809.0, "fp_pred_kg": 27438977.0}, {"airline": "OS", "airport": "WAW", "month_order": 12, "month_name": "Dec", "actual_kg": 213308.0, "flt_pred_kg": 200247.0, "fp_pred_kg": 202623.0}, {"airline": "OS", "airport": "HRG", "month_order": 12, "month_name": "Dec", "actual_kg": 112217.0, "flt_pred_kg": 127867.0, "fp_pred_kg": 128376.0}, {"airline": "OS", "airport": "FRA", "month_order": 12, "month_name": "Dec", "actual_kg": 1023422.0, "flt_pred_kg": 937949.0, "fp_pred_kg": 998790.0}, {"airline": "OS", "airport": "HAM", "month_order": 12, "month_name": "Dec", "actual_kg": 386456.0, "flt_pred_kg": 325932.0, "fp_pred_kg": 336555.0}, {"airline": "OS", "airport": "ORD", "month_order": 12, "month_name": "Dec", "actual_kg": 896475.0, "flt_pred_kg": 770225.0, "fp_pred_kg": 868023.0}, {"airline": "SN", "airport": "WAW", "month_order": 12, "month_name": "Dec", "actual_kg": 109115.0, "flt_pred_kg": 226176.0, "fp_pred_kg": 247013.0}, {"airline": "SN", "airport": "HRG", "month_order": 12, "month_name": "Dec", "actual_kg": 237153.0, "flt_pred_kg": 240823.0, "fp_pred_kg": 249986.0}, {"airline": "SN", "airport": "VIE", "month_order": 12, "month_name": "Dec", "actual_kg": 241469.0, "flt_pred_kg": 191377.0, "fp_pred_kg": 253361.0}, {"airline": "SN", "airport": "HAM", "month_order": 12, "month_name": "Dec", "actual_kg": 111194.0, "flt_pred_kg": 114826.0, "fp_pred_kg": 117000.0}, {"airline": "SN", "airport": "FRA", "month_order": 12, "month_name": "Dec", "actual_kg": 251822.0, "flt_pred_kg": 147991.0, "fp_pred_kg": 223331.0}, {"airline": "WK", "airport": "HRG", "month_order": 12, "month_name": "Dec", "actual_kg": 421904.0, "flt_pred_kg": 441003.0, "fp_pred_kg": 504756.0}, {"airline": "WK", "airport": "KEF", "month_order": 12, "month_name": "Dec", "actual_kg": 40069.0, "flt_pred_kg": 45783.0, "fp_pred_kg": 49122.0}, {"airline": "WK", "airport": "PMI", "month_order": 12, "month_name": "Dec", "actual_kg": 79413.0, "flt_pred_kg": 78295.0, "fp_pred_kg": 79648.0}, {"airline": "XQ", "airport": "VIE", "month_order": 12, "month_name": "Dec", "actual_kg": 318384.0, "flt_pred_kg": 316845.0, "fp_pred_kg": 303068.0}, {"airline": "XQ", "airport": "HAM", "month_order": 12, "month_name": "Dec", "actual_kg": 428535.0, "flt_pred_kg": 468054.0, "fp_pred_kg": 410181.0}, {"airline": "XQ", "airport": "FRA", "month_order": 12, "month_name": "Dec", "actual_kg": 1121772.0, "flt_pred_kg": 1188769.0, "fp_pred_kg": 1072344.0}, {"airline": "XQ", "airport": "WAW", "month_order": 12, "month_name": "Dec", "actual_kg": 98411.0, "flt_pred_kg": 106120.0, "fp_pred_kg": 101193.0}];
const airlinesAll = ["All", "3S", "4Y", "EN", "EW", "LH", "LX", "OS", "SN", "WK", "XQ", "YF"];
const airportsAll = ["All", "BLL", "FRA", "HAM", "HKG", "HRG", "KEF", "ORD", "PMI", "VIE", "WAW"];
const monthNames = ["Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
const monthOrders = [7, 8, 9, 10, 11, 12];

function makeMultiSelect(triggerId, panelId, items, allLabel) {
  const trigger = document.getElementById(triggerId);
  const panel   = document.getElementById(panelId);
  const selected = new Set();

  // "All" row
  const allLbl = document.createElement('label');
  const allCb  = document.createElement('input');
  allCb.type = 'checkbox'; allCb.checked = true;
  allLbl.appendChild(allCb); allLbl.appendChild(document.createTextNode(' ' + allLabel));
  panel.appendChild(allLbl);
  const sep = document.createElement('div'); sep.className = 'ms-sep';
  panel.appendChild(sep);

  const cbs = [];
  items.forEach(item => {
    const lbl = document.createElement('label');
    const cb  = document.createElement('input');
    cb.type = 'checkbox'; cb.value = item;
    lbl.appendChild(cb); lbl.appendChild(document.createTextNode(' ' + item));
    panel.appendChild(lbl);
    cbs.push(cb);
    cb.addEventListener('change', () => {
      if (cb.checked) selected.add(item); else selected.delete(item);
      allCb.checked = selected.size === 0;
      updateTrigger(); updateChart();
    });
  });

  allCb.addEventListener('change', () => {
    if (allCb.checked) { selected.clear(); cbs.forEach(c => c.checked = false); }
    updateTrigger(); updateChart();
  });

  function updateTrigger() {
    if (selected.size === 0) trigger.textContent = allLabel + ' ▾';
    else if (selected.size <= 2) trigger.textContent = Array.from(selected).join(', ') + ' ▾';
    else trigger.textContent = selected.size + ' selected ▾';
  }

  trigger.addEventListener('click', e => { e.stopPropagation(); panel.classList.toggle('open'); });
  panel.addEventListener('click', e => e.stopPropagation());

  return { getSelected: () => selected };
}

const airlineMs = makeMultiSelect('airlineTrigger', 'airlinePanel', airlinesAll.slice(1), 'All airlines');
const airportMs = makeMultiSelect('airportTrigger', 'airportPanel', airportsAll.slice(1), 'All airports');
const airlineExclude = document.getElementById('airlineExclude');
const airportExclude = document.getElementById('airportExclude');

document.addEventListener('click', () => {
  document.getElementById('airlinePanel').classList.remove('open');
  document.getElementById('airportPanel').classList.remove('open');
});

let mode = 'pct';
function setMode(m) {
  mode = m;
  ['btnPct','btnAbs','btnUplift'].forEach(id => document.getElementById(id).classList.remove('active'));
  const activeId = m === 'pct' ? 'btnPct' : m === 'abs' ? 'btnAbs' : 'btnUplift';
  document.getElementById(activeId).classList.add('active');
  updateChart();
}
document.getElementById('btnPct').addEventListener('click', () => setMode('pct'));
document.getElementById('btnAbs').addEventListener('click', () => setMode('abs'));
document.getElementById('btnUplift').addEventListener('click', () => setMode('uplift'));

function computeUplift(rows) {
  const byMonth = {};
  for (const r of rows) {
    if (!byMonth[r.month_order]) byMonth[r.month_order] = { actual: 0, flt: 0, fp: 0, fpCount: 0 };
    byMonth[r.month_order].actual += r.actual_kg;
    byMonth[r.month_order].flt   += r.flt_pred_kg;
    if (r.fp_pred_kg != null) {
      byMonth[r.month_order].fp += r.fp_pred_kg;
      byMonth[r.month_order].fpCount++;
    }
  }
  return monthOrders.map(m => {
    const b = byMonth[m];
    return b ? {
      actual: parseFloat((b.actual / 1000).toFixed(0)),
      flt:    parseFloat((b.flt / 1000).toFixed(0)),
      fp:     b.fpCount > 0 ? parseFloat((b.fp / 1000).toFixed(0)) : null,
    } : { actual: null, flt: null, fp: null };
  });
}

function computeMetric(rows, predKey) {
  const byMonth = {};
  for (const r of rows) {
    if (r[predKey] == null) continue;
    if (!byMonth[r.month_order]) byMonth[r.month_order] = { absErr: 0, actual: 0 };
    byMonth[r.month_order].absErr += Math.abs(r[predKey] - r.actual_kg);
    byMonth[r.month_order].actual += r.actual_kg;
  }
  return monthOrders.map(m => {
    const b = byMonth[m];
    if (!b || b.actual === 0) return null;
    return mode === 'pct'
      ? parseFloat((b.absErr / b.actual * 100).toFixed(2))
      : parseFloat((b.absErr / 1000).toFixed(1));
  });
}

function updateChart() {
  const selAirlines = airlineMs.getSelected();
  const selAirports = airportMs.getSelected();
  const exAirline   = airlineExclude.checked && selAirlines.size > 0;
  const exAirport   = airportExclude.checked && selAirports.size > 0;

  const filtered = allRows.filter(r => {
    const airlineMatch = selAirlines.size === 0 ? true : exAirline ? !selAirlines.has(r.airline) : selAirlines.has(r.airline);
    const airportMatch = selAirports.size === 0 ? true : exAirport ? !selAirports.has(r.airport) : selAirports.has(r.airport);
    return airlineMatch && airportMatch;
  });

  function selLabel(sel, excl, singular, plural) {
    if (sel.size === 0) return null;
    const prefix = excl ? 'excl. ' : '';
    if (sel.size <= 2) return prefix + Array.from(sel).join(', ');
    return prefix + sel.size + ' ' + plural;
  }
  const airlinePart = selLabel(selAirlines, exAirline, 'airline', 'airlines');
  const airportPart = selLabel(selAirports, exAirport, 'airport', 'airports');
  const subtitle = (airlinePart || airportPart)
    ? [airlinePart, airportPart].filter(Boolean).join(' · ')
    : 'All airlines · All airports';

  const baseLayout = {
    barmode: 'group',
    paper_bgcolor: '#16213e',
    plot_bgcolor: '#1a1a2e',
    font: { color: '#e0e0e0', size: 13 },
    height: 420,
    margin: { l: 50, r: 20, t: 40, b: 40 },
    xaxis: { gridcolor: '#2a2a4a', zeroline: false },
    legend: { bgcolor: 'rgba(0,0,0,0.3)', bordercolor: '#2a2a4a' },
    annotations: [{ text: subtitle, x: 0.5, y: 1.06, xref: 'paper', yref: 'paper',
                     showarrow: false, font: { size: 13, color: '#aaa' }, xanchor: 'center' }],
  };

  if (mode === 'uplift') {
    const uplift = computeUplift(filtered);
    const actualY = uplift.map(u => u.actual);
    const fltUY   = uplift.map(u => u.flt);
    const fpUY    = uplift.map(u => u.fp);
    Plotly.react('chart', [
      {
        type: 'bar', name: 'Actual', x: monthNames, y: actualY,
        marker: { color: '#4dabf7' },
        text: actualY.map(v => v != null ? v.toLocaleString() + 't' : ''),
        textposition: 'outside', textfont: { size: 13, color: '#4dabf7' },
      },
      {
        type: 'bar', name: 'FLT', x: monthNames, y: fltUY,
        marker: { color: '#00d4aa' },
        text: fltUY.map(v => v != null ? v.toLocaleString() + 't' : ''),
        textposition: 'outside', textfont: { size: 13, color: '#00d4aa' },
      },
      {
        type: 'bar', name: 'F+', x: monthNames, y: fpUY,
        marker: { color: '#ff6b6b' },
        text: fpUY.map(v => v != null ? v.toLocaleString() + 't' : ''),
        textposition: 'outside', textfont: { size: 13, color: '#ff6b6b' },
      },
    ], { ...baseLayout, yaxis: { title: 'Uplift (t)', gridcolor: '#2a2a4a', zeroline: false } });
    return;
  }

  const fltY = computeMetric(filtered, 'flt_pred_kg');
  const fpY  = computeMetric(filtered.filter(r => r.fp_pred_kg != null), 'fp_pred_kg');

  const annotations = monthNames.map((mn, i) => {
    const f = fltY[i], p = fpY[i];
    if (f == null || p == null) return null;
    const winner = f < p ? 'FLT' : 'F+';
    const color  = f < p ? '#00d4aa' : '#ff6b6b';
    return { x: mn, y: Math.max(f, p) + 0.4, text: winner, showarrow: false,
              font: { size: 11, color, family: 'monospace' } };
  }).filter(Boolean);

  Plotly.react('chart', [
    {
      type: 'bar', name: 'FLT', x: monthNames, y: fltY,
      marker: { color: '#00d4aa' },
      text: fltY.map(v => v != null ? (mode === 'pct' ? v.toFixed(1) + '%' : v.toLocaleString() + 't') : ''),
      textposition: 'outside', textfont: { size: 13, color: '#00d4aa' },
    },
    {
      type: 'bar', name: 'F+', x: monthNames, y: fpY,
      marker: { color: '#ff6b6b' },
      text: fpY.map(v => v != null ? (mode === 'pct' ? v.toFixed(1) + '%' : v.toLocaleString() + 't') : ''),
      textposition: 'outside', textfont: { size: 13, color: '#ff6b6b' },
    },
  ], {
    ...baseLayout,
    yaxis: { title: mode === 'pct' ? 'Error (%)' : 'Misorder (t)', gridcolor: '#2a2a4a', zeroline: false },
    annotations: [...baseLayout.annotations, ...annotations],
  });
}

airlineExclude.addEventListener('change', updateChart);
airportExclude.addEventListener('change', updateChart);
updateChart();
</script>
</body>
</html>